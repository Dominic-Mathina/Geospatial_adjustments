Sp=[1;1;1;1;1;1;1;1;1;1;1;2;2;2;2;2;2;2;2;2;2;2;3;3;3;3;3;3;3;3;3;3;3;4;4;4;4;4;4;4;4;4;4;4;5;5;5;5;5];
Tp=[2;11;12;3;7;4;5;6;8;9;10;1;8;9;10;11;12;7;3;4;5;6;1;8;2;9;10;11;12;7;4;5;6;1;8;2;9;3;10;11;7;12;5;6;1;6;4;3;2];
X=[100.1030;111.6010;122.1810;116.6920;87.6610;86.8550;129.5510;102.4480;126.6760;143.9770;145.6870;133.6100];
Y=[100.0110;109.0030;144.0130;168.0140;134.1990;106.2100;161.8670;90.1670;96.8140;115.7720;140.4290;163.0790];
Dist=[14.5967;49.2302;69.9973;36.5734;59.2302;24.6209];
Spd=[1;1;1;2;2;3];
Tpd=[2;3;4;3;4;4];
P = [1 2 0; 1 11 3.92813; 1 12 26.65768; 1 3 28.14169; 1 7 29.46106; 1 4 42.51533; 1 5 79.96743; 1 6  125.68087; ...]
 1 8 272.63544; 1 9 350.12485; 1 10 379.70302; 2 1 0; 2 8 28.95076; 2 9 114.46143; 2 10 170.86868; 2 11 205.16361; ...
 2 12 233.14019; 2 7 236.9087; 2 3 239.0641; 2 4 252.268; 2 5 306.12031; 2 6 365.52605; 3 1 0; 3 8 7.24369; 3 2 10.92332;...
 3 9 35.65047; 3 10 71.45038; 3 11 119.97324; 3 12 195.22762; 3 7 204.68251; 3 4 243.91905; 3 5 347.23966; ...
 3 6 383.60808; 4 1 0; 4 8 3.71152; 4 2 9.7539; 4 9 24.10203; 4 3 29.5464; 4 10 45.87412; 4 11 66.81895; ...
 4 7 86.84505; 4 12 97.16398; 4 5 370.06912; 4 6 388.29153; 5 1 0; 5 6 380.49429; 5 4 132.61652; 5 3 95.41328; ...
 5 2 26.1527];
DR=P(:,3);

Drad = degtorad(DR * (360/400));
for i=1:6;
    s=Spd(i);
    t=Tpd(i);
    dx=X(t)-X(s);
    dy=Y(t)-Y(s);
    Sc(i)=sqrt(dx^2+dy^2);
    j=2*s-1;
    A(i,j)=-dx/Sc(i);
    A(i,j+1)=-dy/Sc(i);
    j=2*t-1;
    A(i,j)=dx/Sc(i);
    A(i,j+1)=dy/Sc(i);
    dl(i)=Dist(i)-Sc(i);
    dst=dl';
end
  
for n=1:49;
     q=Sp(n);
     r=Tp(n);
      dlx=X(r)-X(q);
     dly=Y(r)-Y(q);
     Sco=sqrt(dlx^2+dly^2);
      m=2*q-1;
     AD(n,m)=dlx/(Sco^2);
     AD(n,m+1)=-dly/(Sco^2);
     m=2*r-1;
     AD(n,m)=-dlx/(Sco^2);
    AD(n,m+1)=dly/(Sco^2); 
    dr=Drad-atan(dly/dlx);
    
 end 
 
     for i =1:11; j=1;
        W(i,j) =  atan((Y(2,1)-Y(1,1))/(X(2,1)-X(1,1)));
       i= 12:22; j=2;
       W(i,j) =  atan((Y(1,1)-Y(2,1))/(X(1,1)-X(2,1)));
        i = 23:33; j=3;     
        W(i,j) =  atan((Y(1,1)-Y(3,1))/(X(1,1)-X(3,1))); 
        i= 34:44;  j=4;
       W(i,j) =  atan((Y(1,1)-Y(4,1))/(X(1,1)-X(4,1)));
       i = 45:49; j=5;       
       W(i,j) =  atan((Y(1,1)-Y(5,1))/(X(1,1)-X(5,1)));
        
     end
    AF=[A zeros(6,21);AD W];
%     Qxx=inv(N);
     N=AF'*AF;
  for i=1;j=1:2:24;
      G(i,j)=1;
      i=2;j=2:2:24;
      G(i,j)=1;
%       i=3;j=1:2:24;
%       G(i,j)= Y;
%       j=2:2:24;
%       G(i,j)= -X;
               
  end
  Gt=[G';zeros(5,2)];
  GF=[G zeros(2,7)];
  GM=[N Gt;GF];
  
  Gu=inv(GM);
  ddy=[dst;dr];
  Abs=AF'*ddy;
  AbsF=[Abs;zeros(2,1)];
  
  FN=Gu*AbsF
  
  
 