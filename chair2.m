 P = [1 2 0; 1 11 3.92813; 1 12 26.65768; 1 3 28.14169; 1 7 29.46106; 1 4 42.51533; 1 5 79.96743; 1 6  125.68087; ...]
 1 8 272.63544; 1 9 350.12485; 1 10 379.70302; 2 1 0; 2 8 28.95076; 2 9 114.46143; 2 10 170.86868; 2 11 205.16361; ...
 2 12 233.14019; 2 7 236.9087; 2 3 239.0641; 2 4 252.268; 2 5 306.12031; 2 6 365.52605; 3 1 0; 3 8 7.24369; 3 2 10.92332;...
 3 9 35.65047; 3 10 71.45038; 3 11 119.97324; 3 12 195.22762; 3 7 204.68251; 3 4 243.91905; 3 5 347.23966; ...
 3 6 383.60808; 4 1 0; 4 8 3.71152; 4 2 9.7539; 4 9 24.10203; 4 3 29.5464; 4 10 45.87412; 4 11 66.81895; ...
 4 7 86.84505; 4 12 97.16398; 4 5 370.06912; 4 6 388.29153; 5 1 0; 5 6 380.49429; 5 4 132.61652; 5 3 95.41328; ...
 5 2 26.1527];
 Spd = P(:,1);
 Tpd = P(:,2);
 DR = P(:,3);
STW = [1; 2; 3; 4; 5; 6; 7; 8; 9; 10; 11; 12];
X = [100.103; 111.601; 122.181; 116.692; 87.661; 86.855; 129.551; 102.448; 126.676; 143.977; 145.687; 133.61];
Y = [100.011; 109.003; 144.013; 168.014; 134.199; 106.21; 161.867; 90.167; 96.814; 115.772; 140.429; 163.079];
Sp = [1; 1; 1; 2; 2; 3];
Tp = [2; 3; 4; 3; 4; 4];
DIST = [14.5967; 49.2302; 69.9973; 36.5734; 59.2302; 24.6209];
DRrad = degtorad(DR * (360/400));

% matrix for distances 
       for i = 1:6;
           s = Sp(i);
           t = Tp(i);
           dx = X(t)-X(s);
           dy = Y(t)-Y(s);
           Sc=sqrt(power(dx,2) +power(dy,2));
           j = 2*s-1 ;
           A1(i,j) = -dx/Sc
           A1(i,j+1)= -dy/Sc
   
           j = 2*t-1;
           A1(i,j) = dx/Sc
           A1(i,j+1) = dy/Sc  
           ds(i) = DIST(i) - Sc;

       end
      dst = ds'
      
      
      for i=1:49
          k = Spd(i);
         h = Tpd(i);
        deltax = X(h)-X(k);
       deltay = Y(h)-Y(k);
        ddr(i,1)=(atan(deltay/deltax)) ;
       
      end
       ddr1=ddr(:,1);
       
% matrix for directions
   for i = 1:49;
       k = Spd(i);
       h = Tpd(i);
       deltax = X(h)-X(k);
       deltay = Y(h)-Y(k);
       ss = sqrt(deltax^2+deltay^2);
       j2 = 2*k-1;
       A2(i,j2) = deltay/(ss^2);
       A2(i,j2+1)= -deltax/(ss^2);
       
       j2=2*h-1;
       A2(i,j2) = -deltay/(ss^2);
       A2(i,j2+1)= deltax/(ss^2);
    
     
   end  
  
   
    for i =1:11; j=1;
       B(i,j) = atan((Y(2,1)-Y(1,1))/(X(2,1)-X(1,1)));
       i= 12:22; j=2;
       B(i,j) = atan((Y(1,1)-Y(2,1))/(X(1,1)-X(2,1)));
       i = 23:33; j=3;
       B(i,j) = atan((Y(3,1)-Y(1,1))/(X(3,1)-X(1,1)));
       i= 34:44;  j=4;
        B(i,j) = atan((Y(4,1)-Y(1,1))/(X(4,1)-X(1,1)));
       i = 45:49; j=5;
       B(i,j) = atan((Y(5,1)-Y(1,1))/(X(5,1)-X(1,1)));
         0
    end
    for i=1:11;j=1;
        C(i,j) = atan((Y(2,1)-Y(1,1))/(X(2,1)-X(1,1)));
        i=12:22;j=1;
        C(i,j) = atan((Y(1,1)-Y(2,1))/(X(1,1)-X(2,1)));
        i = 23:33;j=1;
        C(i,j) = atan((Y(3,1)-Y(1,1))/(X(3,1)-X(1,1)));
        i= 34:44;
        C(i,j) = atan((Y(4,1)-Y(1,1))/(X(4,1)-X(1,1)));
        i = 45:49 ;
        C(i,j) = atan((Y(5,1)-Y(1,1))/(X(5,1)-X(1,1)));
        
        
        
    end
%  LO is   L orientred
% 
%   for i=1:49;
%       P(i)= pi;
%       
%   end
%   P1 = P(:,1);
     LO = DRrad + C;
     GT = LO(LO > pi)-pi;
     LT= LO(LO<pi); 
     Fi=[0.6637
    0.7254
    1.0824
    1.1057
    1.1265
    1.3315
    1.9198
    2.6379
    1.8047
    3.0219
    3.4865
    0.6637
    1.1185
    2.4617
    0.2061
    0.7448
    1.1843
    1.2435
    1.2773
    1.4847
    2.3306
    3.2638
    1.1057
    1.2195
    1.2773
    1.6657
    2.2281
    2.9903
    1.0308
    1.1793
    1.7956
    3.4186
    3.9899
    1.3315
    1.3898
    1.4847
    1.7101
    1.7956
    2.0521
    2.3811
    2.6957
    2.8578
    4.0030
    4.2892
   -1.2218
    1.6134
    0.8614
    0.2770
   -0.8110];

GT1=Fi(Fi>pi) -pi;
LT1 =Fi(Fi<pi);
Fn=[0.6637
    0.7254
    1.0824
    1.1057
    1.1265
    1.3315
    1.9198
    2.6379
    1.8047
    3.0219
    0.3449
    0.6637
    1.1185
    2.4617
    0.2061
    0.7448
    1.1843
    1.2435
    1.2773
    1.4847
    2.3306
    0.1222
    1.1057
    1.2195
    1.2773
    1.6657
    2.2281
    2.9903
    1.0308
    1.1793
    1.7956
    0.2770
    0.8483
    1.3315
    1.3898
    1.4847
    1.7101
    1.7956
    2.0521
    2.3811
    2.6957
    2.8578
    0.8614
    1.1476
   -1.2218
    1.6134
    0.8614
    0.2770
   -0.8110];

ddr3 =ddr1(ddr1<0);
ddr4=ddr3(1:16)+pi;

ddr5=[0.6637
    0.7254
    1.0824
    1.1057
    1.1265
    1.3315
    1.9198
    2.7039
    1.8047
    3.0219
    0.3449
    0.6637
    1.1185
    2.4617
    0.2061
    0.7448
    1.1843
    1.2435
    1.2773
    1.4847
    2.3306
    0.1124
    1.1057
    1.2195
    1.2773
    1.6657
    2.2281
    2.9903
    1.0308
    1.1793
    1.7956
    0.2770
    0.8193
    1.3315
    1.3898
    1.4847
    1.7101
    1.7956
    2.0521
    2.3811
    2.6957
    2.8578
    0.8614
    1.1210
   -1.2218
    1.5420
    0.8614
    0.2770
   -0.8110]

%  ddr=(atan(deltay/deltax));

% t = 0:0.01:0.2; 
% tp = 0.09; 
% ts = 0.15; 
% for h = 1:length(t)
%     if t(h) <= tp 
%         f(h)=(sin((pi*t(h))/(2*tp)))^2
%     elseif t(h) > tp && t(h) <= ts
%         f(h)=(cos((pi*(t(h)-tp))/(2*(ts-tp))))^2
%     else
%         f(h)=0
%     end
% end





    
%     for i = LO
%         if LO(i) <= pi
%             dL = LO;
%         elseif LO(i) > pi
%             dL = LO -pi
%         else
%             dL = 0
%         end
%     end
     


    A = [A1 zeros(6,21); A2 B];
    N = A'*A;
%    Qxx =  inv(N);
for i =1; j=1:2:24;
     G(i,j)=1;
     i=2; j=2:2:24; 
     G(i,j) = 1;
     i=3; j=1:2:24;
     G(i,j) = Y;
     i=3;  j=2:2:24;
     G(i,j)= -X;  

end

for i=1:2:24;j=1;
    Coord(i,j) = X;
    i=2:2:24;j=1;
    Coord(i,j)=Y
    
end
% Gt,G-Transpose  Gf, G-final GM,G-Matrix
 Gt = [G' ; zeros(5,3)];
 Gf = [G zeros(3,8)];
 GM = [N Gt; Gf];
      ddr2=Fn-ddr5
      
% sY, small_Y, dL-delta_L, dLf-delta_L final
 sY=[dst;ddr2];
 dL = A'*sY;
 dLf =[dL;zeros(3,1)];
 Gu = inv(GM);
 
 delX =Gu*dLf